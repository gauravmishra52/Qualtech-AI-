<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QualTech AI</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/css/styles.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
            color: white;
            padding: 100px 0;
        }

        .auth-modal .modal-content {
            border-radius: 15px;
        }

        .auth-modal .modal-header {
            border-bottom: none;
            padding-bottom: 0;
        }

        .auth-modal .modal-body {
            padding: 30px 40px;
        }

        .auth-modal .form-control {
            border-radius: 10px;
            padding: 12px 15px;
        }

        .auth-modal .btn-primary {
            border-radius: 10px;
            padding: 12px;
        }

        .auth-tabs .nav-link {
            border: none;
            color: #666;
            font-weight: 500;
        }

        .auth-tabs .nav-link.active {
            color: #0d6efd;
            border-bottom: 2px solid #0d6efd;
            background: transparent;
        }

        .otp-input {
            width: 50px !important;
            height: 50px;
            text-align: center;
            font-size: 24px;
            margin: 0 5px;
        }

        .auth-step {
            display: none;
        }

        .auth-step.active {
            display: block;
        }

        .user-dropdown {
            display: none;
        }

        .auth-buttons {
            display: flex;
        }

        body.logged-in .user-dropdown {
            display: block;
        }

        body.logged-in .auth-buttons {
            display: none;
        }

        .alert-floating {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
        }

        .reset-password-container {
            display: none;
        }

        .reset-password-container.active {
            display: block;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="bi bi-cpu me-2"></i>QualTech AI
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/landing.html">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Contact</a>
                    </li>
                </ul>
                <!-- Auth Buttons (shown when NOT logged in) -->
                <div class="auth-buttons">
                    <button class="btn btn-outline-light me-2" data-bs-toggle="modal" data-bs-target="#authModal"
                        onclick="showLoginTab()">
                        <i class="bi bi-box-arrow-in-right me-1"></i>Login
                    </button>
                    <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#authModal"
                        onclick="showRegisterTab()">
                        <i class="bi bi-person-plus me-1"></i>Register
                    </button>
                </div>
                <!-- User Dropdown (shown when logged in) -->
                <div class="user-dropdown dropdown">
                    <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle me-1"></i><span id="userName">User</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="/dashboard.html"><i
                                    class="bi bi-speedometer2 me-2"></i>Dashboard</a></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item text-danger" href="#" onclick="logout()"><i
                                    class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Reset Password Container (shown when ?token= with reset context) -->
    <div class="reset-password-container" id="resetPasswordContainer">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-5">
                            <h4 class="text-center mb-4">
                                <i class="bi bi-key text-primary me-2"></i>Reset Your Password
                            </h4>
                            <form id="resetPasswordForm">
                                <input type="hidden" id="resetToken">
                                <div class="mb-3">
                                    <label for="newPassword" class="form-label">New Password</label>
                                    <input type="password" class="form-control" id="newPassword" required minlength="8">
                                    <div class="form-text">Must be at least 8 characters</div>
                                </div>
                                <div class="mb-3">
                                    <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                                    <input type="password" class="form-control" id="confirmNewPassword" required>
                                </div>
                                <button type="submit" class="btn btn-primary w-100" id="resetPasswordBtn">
                                    <span class="spinner-border spinner-border-sm d-none me-2" role="status"></span>
                                    Reset Password
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div id="mainContent">
        <!-- Hero Section -->
        <header class="hero-section">
            <div class="container text-center">
                <h1 class="display-4 fw-bold mb-4">Welcome to QualTech AI</h1>
                <p class="lead mb-4">Your intelligent solution for quality technology services</p>
                <a href="#features" class="btn btn-light btn-lg px-5">
                    <i class="bi bi-arrow-down-circle me-2"></i>Learn More
                </a>
            </div>
        </header>

        <!-- Features Section -->
        <section id="features" class="py-5">
            <div class="container">
                <h2 class="text-center mb-5 fw-bold">Our Features</h2>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-body text-center p-4">
                                <div class="feature-icon bg-primary bg-gradient text-white rounded-circle mb-3 mx-auto"
                                    style="width: 60px; height: 60px; line-height: 60px;">
                                    <i class="bi bi-lightbulb fs-4"></i>
                                </div>
                                <h5 class="card-title fw-bold">AI Solutions</h5>
                                <p class="card-text text-muted">High-quality AI solutions tailored to your needs.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-body text-center p-4">
                                <div class="feature-icon bg-success bg-gradient text-white rounded-circle mb-3 mx-auto"
                                    style="width: 60px; height: 60px; line-height: 60px;">
                                    <i class="bi bi-rocket-takeoff fs-4"></i>
                                </div>
                                <h5 class="card-title fw-bold">Cutting-Edge Tech</h5>
                                <p class="card-text text-muted">Cutting-edge technology for modern businesses.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-body text-center p-4">
                                <div class="feature-icon bg-info bg-gradient text-white rounded-circle mb-3 mx-auto"
                                    style="width: 60px; height: 60px; line-height: 60px;">
                                    <i class="bi bi-headset fs-4"></i>
                                </div>
                                <h5 class="card-title fw-bold">24/7 Support</h5>
                                <p class="card-text text-muted">24/7 support and maintenance services.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="bg-light py-5">
            <div class="container">
                <h2 class="text-center mb-5 fw-bold">Contact Us</h2>
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4">
                                <form id="contactForm">
                                    <div class="mb-3">
                                        <label for="contactName" class="form-label fw-semibold">Name</label>
                                        <input type="text" class="form-control" id="contactName" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="contactEmail" class="form-label fw-semibold">Email</label>
                                        <input type="email" class="form-control" id="contactEmail" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="contactMessage" class="form-label fw-semibold">Message</label>
                                        <textarea class="form-control" id="contactMessage" rows="4" required></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary px-4">
                                        <i class="bi bi-send me-2"></i>Send Message
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-dark text-white py-4">
            <div class="container text-center">
                <p class="mb-0">&copy; 2025 QualTech AI. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Auth Modal -->
    <div class="modal fade auth-modal" id="authModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <ul class="nav nav-tabs auth-tabs w-100 justify-content-center" id="authTabs">
                        <li class="nav-item">
                            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login"
                                type="button">Login</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register"
                                type="button">Register</button>
                        </li>
                    </ul>
                    <button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="tab-content">
                        <!-- Login Tab -->
                        <div class="tab-pane fade show active" id="login">
                            <form id="loginForm">
                                <div class="mb-3">
                                    <label for="loginEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="loginEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label for="loginPassword" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="loginPassword" required>
                                </div>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="rememberMe">
                                    <label class="form-check-label" for="rememberMe">Remember me</label>
                                </div>
                                <button type="submit" class="btn btn-primary w-100" id="loginBtn">
                                    <span class="spinner-border spinner-border-sm d-none me-2" role="status"></span>
                                    Login
                                </button>
                                <div class="text-center mt-3">
                                    <a href="#" class="text-decoration-none" data-bs-toggle="modal"
                                        data-bs-target="#forgotPasswordModal" data-bs-dismiss="modal">Forgot
                                        Password?</a>
                                </div>
                            </form>
                        </div>

                        <!-- Register Tab -->
                        <div class="tab-pane fade" id="register">
                            <!-- Step 1: Registration Form -->
                            <div class="auth-step active" id="registerStep1">
                                <h5 class="text-center mb-4">Create your account</h5>
                                <form id="registerStep1Form">
                                    <div class="mb-3">
                                        <label for="registerName" class="form-label">Full Name</label>
                                        <input type="text" class="form-control" id="registerName" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="registerEmail" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="registerEmail" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="registerPassword" class="form-label">Password</label>
                                        <input type="password" class="form-control" id="registerPassword" required
                                            minlength="8">
                                        <div class="form-text">Must be at least 8 characters</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="confirmPassword" class="form-label">Confirm Password</label>
                                        <input type="password" class="form-control" id="confirmPassword" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100" id="registerBtn">
                                        <span class="spinner-border spinner-border-sm d-none me-2" role="status"></span>
                                        Register
                                    </button>
                                </form>
                            </div>

                            <!-- Step 2: OTP Verification -->
                            <div class="auth-step" id="registerStep2">
                                <div class="text-center mb-4">
                                    <i class="bi bi-envelope-check text-primary" style="font-size: 48px;"></i>
                                    <h5 class="mt-3">Verify your email</h5>
                                    <p class="text-muted">We've sent a verification code to<br><strong
                                            id="verifyEmailDisplay"></strong></p>
                                </div>
                                <form id="otpForm">
                                    <div class="d-flex justify-content-center mb-4">
                                        <input type="text" class="form-control otp-input" maxlength="1" required>
                                        <input type="text" class="form-control otp-input" maxlength="1" required>
                                        <input type="text" class="form-control otp-input" maxlength="1" required>
                                        <input type="text" class="form-control otp-input" maxlength="1" required>
                                        <input type="text" class="form-control otp-input" maxlength="1" required>
                                        <input type="text" class="form-control otp-input" maxlength="1" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100" id="verifyBtn">
                                        <span class="spinner-border spinner-border-sm d-none me-2" role="status"></span>
                                        Verify Email
                                    </button>
                                    <div class="text-center mt-3">
                                        <span class="text-muted">Didn't receive the code? </span>
                                        <a href="#" class="text-decoration-none" onclick="resendOtp()">Resend</a>
                                    </div>
                                </form>
                            </div>

                            <!-- Step 3: Success -->
                            <div class="auth-step" id="registerStep3">
                                <div class="text-center">
                                    <i class="bi bi-check-circle-fill text-success" style="font-size: 64px;"></i>
                                    <h4 class="mt-3">Registration Successful!</h4>
                                    <p class="text-muted">Your account has been created successfully.</p>
                                    <button type="button" class="btn btn-primary" onclick="goToLogin()">Login
                                        Now</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade auth-modal" id="forgotPasswordModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Reset Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="forgotPasswordForm">
                        <p class="text-muted">Enter your email address and we'll send you a link to reset your password.
                        </p>
                        <div class="mb-3">
                            <label for="resetEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="resetEmail" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100" id="forgotBtn">
                            <span class="spinner-border spinner-border-sm d-none me-2" role="status"></span>
                            Send Reset Link
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const API_BASE = '/api/auth';
        let registrationEmail = '';

        // Check URL parameters and authentication state on page load
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const path = window.location.pathname;

            // Handle password reset page
            if (path === '/reset-password' && token) {
                showResetPasswordPage(token);
                return;
            }

            // Check if user is already logged in
            const authToken = localStorage.getItem('authToken');
            const userName = localStorage.getItem('userName');
            if (authToken) {
                document.body.classList.add('logged-in');
                document.getElementById('userName').textContent = userName || 'User';
            }

            // OTP input auto-focus
            const otpInputs = document.querySelectorAll('.otp-input');
            otpInputs.forEach((input, index) => {
                input.addEventListener('input', function () {
                    if (this.value.length === 1 && index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    }
                });
                input.addEventListener('keydown', function (e) {
                    if (e.key === 'Backspace' && this.value === '' && index > 0) {
                        otpInputs[index - 1].focus();
                    }
                });
            });
        });

        function showResetPasswordPage(token) {
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('resetPasswordContainer').classList.add('active');
            document.getElementById('resetToken').value = token;
        }

        function showLoginTab() {
            document.getElementById('login-tab').click();
            resetRegisterSteps();
        }

        function showRegisterTab() {
            document.getElementById('register-tab').click();
            resetRegisterSteps();
        }

        function resetRegisterSteps() {
            document.querySelectorAll('.auth-step').forEach(step => step.classList.remove('active'));
            document.getElementById('registerStep1').classList.add('active');
        }

        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-floating alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 5000);
        }

        function setLoading(buttonId, loading) {
            const btn = document.getElementById(buttonId);
            if (!btn) return;
            const spinner = btn.querySelector('.spinner-border');
            if (loading) {
                btn.disabled = true;
                spinner?.classList.remove('d-none');
            } else {
                btn.disabled = false;
                spinner?.classList.add('d-none');
            }
        }

        // Login Form
        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            setLoading('loginBtn', true);

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem('authToken', data.accessToken);
                    localStorage.setItem('refreshToken', data.refreshToken);
                    localStorage.setItem('userName', data.username || email.split('@')[0]);
                    localStorage.setItem('userEmail', data.email);
                    localStorage.setItem('userId', data.id);

                    document.body.classList.add('logged-in');
                    document.getElementById('userName').textContent = data.username || email.split('@')[0];
                    bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                    showAlert('Login successful! Welcome back.', 'success');
                } else {
                    showAlert(data.error || data.message || 'Login failed', 'danger');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'danger');
            } finally {
                setLoading('loginBtn', false);
            }
        });

        // Register Step 1
        document.getElementById('registerStep1Form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                showAlert('Passwords do not match', 'danger');
                return;
            }

            setLoading('registerBtn', true);

            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            registrationEmail = email;

            try {
                const response = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: name,
                        email: email,
                        password: password
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('verifyEmailDisplay').textContent = email;
                    document.getElementById('registerStep1').classList.remove('active');
                    document.getElementById('registerStep2').classList.add('active');
                    showAlert('OTP Sent! Please check your email.', 'success');
                } else {
                    showAlert(data.error || data.message || 'Registration failed', 'danger');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'danger');
            } finally {
                setLoading('registerBtn', false);
            }
        });

        // OTP Verification
        document.getElementById('otpForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            setLoading('verifyBtn', true);

            const otpInputs = document.querySelectorAll('.otp-input');
            const otp = Array.from(otpInputs).map(input => input.value).join('');

            if (otp.length !== 6) {
                showAlert('Please enter the complete 6-digit code', 'warning');
                setLoading('verifyBtn', false);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/verify-otp`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: registrationEmail, otp: otp })
                });

                if (response.ok) {
                    document.getElementById('registerStep2').classList.remove('active');
                    document.getElementById('registerStep3').classList.add('active');
                } else {
                    const data = await response.json();
                    showAlert(data.error || data.message || 'Verification failed', 'danger');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'danger');
            } finally {
                setLoading('verifyBtn', false);
            }
        });

        function resendOtp() {
            // Basic resend logic - essentially re-triggering registration of same user?
            // Or we need a resend endpoint. For now just show alert.
            showAlert('Please try registering again to receive a new OTP', 'info');
        }

        function goToLogin() {
            resetRegisterSteps();
            document.getElementById('login-tab').click();
            if (registrationEmail) {
                document.getElementById('loginEmail').value = registrationEmail;
            }
        }

        function logout() {
            const refreshToken = localStorage.getItem('refreshToken');

            if (refreshToken) {
                fetch(`${API_BASE}/logout`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ refreshToken })
                }).catch(() => { });
            }

            localStorage.removeItem('authToken');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('userName');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userId');
            document.body.classList.remove('logged-in');
            showAlert('You have been logged out', 'info');
        }

        // Contact Form
        document.getElementById('contactForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const message = document.getElementById('contactMessage').value;

            try {
                const response = await fetch('/api/contact', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, message })
                });

                if (response.ok) {
                    showAlert('Message sent successfully! We\'ll get back to you soon.', 'success');
                    this.reset();
                } else {
                    showAlert('Failed to send message. Please try again.', 'danger');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'danger');
            }
        });

        // Forgot Password
        document.getElementById('forgotPasswordForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            setLoading('forgotBtn', true);

            const email = document.getElementById('resetEmail').value;

            try {
                const response = await fetch(`${API_BASE}/forgot-password?email=${encodeURIComponent(email)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    showAlert('Password reset link sent to your email', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('forgotPasswordModal')).hide();
                } else {
                    const data = await response.json();
                    showAlert(data.error || 'Failed to send reset link', 'danger');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'danger');
            } finally {
                setLoading('forgotBtn', false);
            }
        });

        // Reset Password Form
        document.getElementById('resetPasswordForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            const token = document.getElementById('resetToken').value;

            if (newPassword !== confirmNewPassword) {
                showAlert('Passwords do not match', 'danger');
                return;
            }

            setLoading('resetPasswordBtn', true);

            try {
                const response = await fetch(`${API_BASE}/reset-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token, newPassword })
                });

                if (response.ok) {
                    showAlert('Password reset successfully! You can now login.', 'success');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                } else {
                    const data = await response.json();
                    showAlert(data.error || 'Failed to reset password', 'danger');
                }
            } catch (error) {
                showAlert('Network error. Please try again.', 'danger');
            } finally {
                setLoading('resetPasswordBtn', false);
            }
        });
    </script>
</body>

</html>